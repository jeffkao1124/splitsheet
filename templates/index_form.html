<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1" />
    <title>分帳表單</title>
    <script src="https://d.line-scdn.net/liff/1.0/sdk.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
 <script>  
        var countMin = 1;  
        var countMax = 10; 
        var commonName = "T";
        var commonsplit = "splitter";
        var count = countMin;  
        function addField() {  
            if(count == countMax)  
                alert("最多"+countMax+"個欄位");  
            else      
                document.getElementById("fieldSpace").innerHTML += "<p><strong>分帳者 " + (++count) + '：<input id="' + commonsplit + (count)+'" type="text" name="' + commonName + count + '"></strong></p>';
               
        } 
        function delField() { 
            if (count > countMin) { 
                var fs = document.getElementById("fieldSpace");  
                fs.removeChild(fs.lastChild); 
                count--; 
            } else { 
                alert("無新增欄位可以刪除"); 
            }    
        } 
</script> 
<script>
	function initializeApp(data) {  //初始化LIFF
        var userid = data.context.userId;
        var groupid = data.context.groupId; //取得ID
        document.getElementById('post_groupID').value =groupid;

	}
	function pushMsg(item, cost, payer) {

		if (item == '' || cost == '' || payer=='') {  //資料檢查
            alert('每個項目都必須輸入！');
            return;
        }
        for(i=1 ; i<(count+1) ; i++){
            if ($('#splitter'+i).val() =='') {
                alert('每個項目都必須輸入！');
                return;
        }
        
        }
        var msg = "分帳 ";  //回傳訊息字串
		msg = msg + item + " ";
        msg = msg + cost + " ";
        msg = msg + payer+ " ";
        for(i=1 ; i<(count+1) ; i++){
            splitperson = $('#splitter'+i).val()
            msg = msg + splitperson +" ";
        }
        

		liff.sendMessages([  //推播訊息
			{ type: 'text',
			  text: msg 
			},
		])
			.then(() => {
				liff.closeWindow();  //關閉視窗
			});
	}

	$(document).ready(function () {
    
		liff.init(function (data) {  //初始化LIFF
            initializeApp(data);
		});
		
		$('#sure').click(function (e) {  //按下確定鈕
			pushMsg($('#item').val(), $('#cost').val(), $('#payer').val()); 
		});
	});
</script>
<!--<script>
    const pg = require('pg');

    const config = {
        host: 'ec2-54-236-146-234.compute-1.amazonaws.com',
        user: 'szcllceapwexar',     
        password: '6de14fbb3a64a6ac2c1f81d1a6f6e528ee13cdbf7e2abf80ee0f57396180b228',
        database: 'deu86ol7k69o7t',
        port: 5432,
        ssl: true
    };

    const client = new pg.Client(config);

    client.connect(err => {
        if (err) throw err;
        else { queryDatabase(); }
    });

    function queryDatabase() {
  
        console.log(`Running query to PostgreSQL server: ${config.host}`);

        const query = 'SELECT * FROM usermessage;';

        client.query(query)
            .then(res => {
                const rows = res.rows;

                rows.map(row => {
                    console.log(`Read: ${JSON.stringify(row)}`);
                });
                alert("hello");

                process.exit();
            })
            .catch(err => {
                console.log(err);

            });
    }

</script>-->
</head>
<body>
<div>
    <h1>歡迎進入分帳</h1>
    <form method='post' action="{{url_for ('index')}}">
        <p><input id='post_groupID' type="hidden" name="groupId" value='0'></p>
        <p><button type="submit">點我</button></p>
    </form>
</div>    
<div align="center">
    <br><img style="float: center" src="https://scontent-tpe1-1.xx.fbcdn.net/v/t1.0-9/118591971_3901929859834211_9155588508050284823_o.jpg?_nc_cat=107&_nc_sid=8024bb&_nc_ohc=ijfpRatlcXQAX-dLZNp&_nc_ht=scontent-tpe1-1.xx&oh=b3e5d8e6be58665e1930d6581bf5c96d&oe=5F6DA126" alt="logo" width="110" height="110"/></br><p></p><h3>Welcome to</h3></p><h3><span style="background-color: #914c53; color: #ffffff;">Account Mastiff</span></h3>
    <br/>
    <p><strong><form>項目：<input id="item" type="text" name="欄位名稱"></strong></p></form>
    <p><strong><form>金額：<input id="cost" type="number" name="欄位名稱" value=""></strong></p></form>
    <p><strong><form>代墊者：<input id="payer" type="text" name="欄位名稱"></strong></p></form>
    <p><strong>-------代墊者也是分帳者之一</strong></p>
    <form>
        <p><strong>分帳者 1：<input id="splitter1" type="text" name="T1"></strong></p>  
        <p> {{ a }} </p>
        <p> {{ b }} </p>
        <span id="fieldSpace"></span> 
        <a href="javascript:" onclick="addField()">增加</a> 
        <a href="javascript:" onclick="delField()">刪除</a> 
    </form>  
    <br/>
	<button id="sure">確認送出</button>
</div>
</body>
</html>

